{"version":3,"file":"index.mjs","sources":["../src/errors/IErrors.ts","../src/errors/normalizeErrors.ts","../src/utils/valueOf.ts","../src/predicates/isEqual.ts","../src/predicates/isRequired.ts","../src/validator.ts","../src/state/ValidationState.ts"],"sourcesContent":["export interface IErrors {\r\n  [key: string]: IErrors | any;\r\n}\r\n\r\nexport const Errors = Object.freeze({\r\n  EMPTY: Object.freeze({}),\r\n  required: 'required',\r\n  null: 'null',\r\n  equal: 'equal',\r\n  minLength: 'min-length',\r\n  maxLength: 'max-length'\r\n});\r\n","import { IErrors, Errors } from './IErrors';\r\n\r\nexport function normalizeErrors(errors: IErrors | string) {\r\n  if (typeof errors !== 'object') return errors;\r\n\r\n  return Object.keys(errors).reduce((result, key) => {\r\n    const value = normalizeErrors(errors[key]);\r\n    return value === Errors.EMPTY\r\n      ? result\r\n      : {\r\n          ...result,\r\n          [key]: value\r\n        };\r\n  }, Errors.EMPTY);\r\n}\r\n","export function valueOf(o: object) {\r\n    return o.valueOf ? o.valueOf() : Object.prototype.valueOf.call(o);\r\n}\r\n","import { valueOf } from \"../utils\";\r\n\r\n/** deep equality check */\r\nexport function isEqual(a: any, b: any): boolean {\r\n  if (a === b) return true;\r\n  \r\n  if (a == null || b == null) return false;\r\n\r\n  if (Array.isArray(a)) {\r\n    return (\r\n      Array.isArray(b) &&\r\n      a.length === b.length &&\r\n      a.every((v, i) => isEqual(v, b[i]))\r\n    );\r\n  }\r\n  \r\n  if (typeof a === 'object' || typeof b === 'object') {\r\n    const av = valueOf(a);\r\n    const bv = valueOf(b);\r\n    if (av !== a || bv !== b) return isEqual(av, bv);\r\n    return Object.keys({ ...a, ...b }).every(n => isEqual(a[n], b[n]));\r\n  }\r\n  \r\n  return false;\r\n}\r\n","export function isRequired(a: any): boolean {\r\n  return !a;\r\n}\r\n","import { IErrors, Errors } from './errors';\r\nimport { isRequired, isEqual } from './predicates';\r\n\r\nexport class Validator {\r\n  constructor(private errors: IErrors, private negated: boolean = false) {}\r\n\r\n  get not(): Validator {\r\n    return new Validator(this.errors, true);\r\n  }\r\n\r\n  private exec(\r\n    success: boolean,\r\n    errorKey: string,\r\n    errorValue: any = true\r\n  ): IErrors {\r\n    if (this.negated) success = !success;\r\n    return success\r\n      ? Errors.EMPTY\r\n      : { [`${this.negated ? 'not-' : ''}${errorKey}`]: errorValue };\r\n  }\r\n\r\n  required(a: any) {\r\n    return this.exec(isRequired(a), Errors.required);\r\n  }\r\n\r\n  null(a: any): IErrors {\r\n    return this.exec(a == null, Errors.null);\r\n  }\r\n\r\n  equal<T>(a: T, b: T): IErrors {\r\n    return this.exec(isEqual(a, b), Errors.equal);\r\n  }\r\n\r\n  minLength(v: string, min: number): IErrors {\r\n    return this.exec(v.length < min, Errors.minLength);\r\n  }\r\n\r\n  maxLength(v: string, max: number): IErrors {\r\n    return this.exec(v.length > max, Errors.maxLength);\r\n  }\r\n}\r\n\r\nexport const validate = new Validator({}, false);\r\n","import { isEqual } from '../predicates';\r\nimport { IErrors, Errors, normalizeErrors } from '../errors';\r\nimport { IValidationState } from './IValidationState';\r\n\r\nexport class ValidationState<TValue> implements IValidationState<TValue> {\r\n  constructor(public value: TValue, private validate: (v: TValue) => IErrors) {}\r\n\r\n  errors: IErrors;\r\n  invalid: boolean;\r\n\r\n  set(value: any): boolean {\r\n    if (isEqual(this.value, value)) return false;\r\n    this.value = value;\r\n    this.errors = this.validate(value);\r\n    this.invalid = normalizeErrors(this.errors) !== Errors.EMPTY;\r\n    return true;\r\n  }\r\n}\r\n"],"names":[],"mappings":"MAIa,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;IAClC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC;IACxB,QAAQ,EAAE,UAAU;IACpB,IAAI,EAAE,MAAM;IACZ,KAAK,EAAE,OAAO;IACd,SAAS,EAAE,YAAY;IACvB,SAAS,EAAE,YAAY;CACxB,CAAC;;SCTc,eAAe,CAAC,MAAwB;IACtD,IAAI,OAAO,MAAM,KAAK,QAAQ;QAAE,OAAO,MAAM,CAAC;IAE9C,OAAO,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,GAAG;QAC5C,MAAM,KAAK,GAAG,eAAe,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;QAC3C,OAAO,KAAK,KAAK,MAAM,CAAC,KAAK;cACzB,MAAM;8CAED,MAAM,KACT,CAAC,GAAG,GAAG,KAAK,GACb,CAAC;KACP,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;CAClB;;SCde,OAAO,CAAC,CAAS;IAC7B,OAAO,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,OAAO,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;CACrE;;ACAD;AACA,SAAgB,OAAO,CAAC,CAAM,EAAE,CAAM;IACpC,IAAI,CAAC,KAAK,CAAC;QAAE,OAAO,IAAI,CAAC;IAEzB,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI;QAAE,OAAO,KAAK,CAAC;IAEzC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;QACpB,QACE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;YAChB,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM;YACrB,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EACnC;KACH;IAED,IAAI,OAAO,CAAC,KAAK,QAAQ,IAAI,OAAO,CAAC,KAAK,QAAQ,EAAE;QAClD,MAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;QACtB,MAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;QACtB,IAAI,EAAE,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC;YAAE,OAAO,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACjD,OAAO,MAAM,CAAC,IAAI,iCAAM,CAAC,GAAK,CAAC,EAAG,CAAC,KAAK,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;KACpE;IAED,OAAO,KAAK,CAAC;CACd;;SCxBe,UAAU,CAAC,CAAM;IAC/B,OAAO,CAAC,CAAC,CAAC;CACX;;MCCY,SAAS;IACpB,YAAoB,MAAe,EAAU,UAAmB,KAAK;QAAjD,WAAM,GAAN,MAAM,CAAS;QAAU,YAAO,GAAP,OAAO,CAAiB;KAAI;IAEzE,IAAI,GAAG;QACL,OAAO,IAAI,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;KACzC;IAEO,IAAI,CACV,OAAgB,EAChB,QAAgB,EAChB,aAAkB,IAAI;QAEtB,IAAI,IAAI,CAAC,OAAO;YAAE,OAAO,GAAG,CAAC,OAAO,CAAC;QACrC,OAAO,OAAO;cACV,MAAM,CAAC,KAAK;cACZ,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,GAAG,MAAM,GAAG,EAAE,GAAG,QAAQ,EAAE,GAAG,UAAU,EAAE,CAAC;KAClE;IAED,QAAQ,CAAC,CAAM;QACb,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;KAClD;IAED,IAAI,CAAC,CAAM;QACT,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;KAC1C;IAED,KAAK,CAAI,CAAI,EAAE,CAAI;QACjB,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC;KAC/C;IAED,SAAS,CAAC,CAAS,EAAE,GAAW;QAC9B,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,GAAG,GAAG,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;KACpD;IAED,SAAS,CAAC,CAAS,EAAE,GAAW;QAC9B,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,GAAG,GAAG,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;KACpD;CACF;AAED,MAAa,QAAQ,GAAG,IAAI,SAAS,CAAC,EAAE,EAAE,KAAK,CAAC;;MCtCnC,eAAe;IAC1B,YAAmB,KAAa,EAAU,QAAgC;QAAvD,UAAK,GAAL,KAAK,CAAQ;QAAU,aAAQ,GAAR,QAAQ,CAAwB;KAAI;IAK9E,GAAG,CAAC,KAAU;QACZ,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC;YAAE,OAAO,KAAK,CAAC;QAC7C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,OAAO,GAAG,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,MAAM,CAAC,KAAK,CAAC;QAC7D,OAAO,IAAI,CAAC;KACb;CACF;;;;"}